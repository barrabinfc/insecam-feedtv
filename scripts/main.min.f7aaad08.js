(function(){var a,b,c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty,i=function(a,b){return function(){return a.apply(b,arguments)}};f=function(){return console.log("togglefullscreen"),document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),$("#bt-fullscreen").show()):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),$("#bt-fullscreen").hide())},window.cyclePhoto=function(a){console.log(a)},e=null!=e?e:{el:"#cameralist",cycle:{left_time:15e3,left_start:1e3,right_time:15e3,right_start:5e3},camfeed:{url:"assets/cameras.feed.json",feeds:[]}},d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.defaults={uri:"http://158.39.49.51:80/mjpg/video.mjpg",country:"Russia",city:"Megalopole"},b}(Backbone.Model),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.model=d,b.prototype.localStorage=new Store("CameraFeeds"),b.prototype.historyWeight=[],b.prototype.add=function(a,b){return this.historyWeight.push(1),console.log("Opts, it twerked!"),Backbone.Collection.prototype.add.call(this,a,b),this.trigger("added",a)},b.prototype.pickRandom=function(){var a;return a=chance.pick(this.models)},b.prototype.pickSemiRandom=function(){var a,b;return b=chance.weighted(this.models,this.historyWeight),a=this.models.indexOf(b),this.historyWeight[a]=this.historyWeight[a]/4,b},b}(Backbone.Collection),b=function(a){function b(){return this.unrender=i(this.unrender,this),this.hidePhoto=i(this.hidePhoto,this),this.render=i(this.render,this),this.cycle=i(this.cycle,this),b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.tagName="section",b.prototype.className="feed-box",b.prototype.template=_.template('<div class="feed-stream">\n<img src="<%= uri %>"\n    caption="<%= city %>" \n    onerror="cyclePhoto">\n</div>'),b.prototype.initialize=function(){return this.model.bind("add",this.render),this.model.bind("change",this.render),this.model.bind("remove",this.unrender)},b.prototype.cycle=function(a){return this.model.set("uri",a.get("uri")),this.model.set("city",a.get("uri")),this.model.set("country",a.get("country"))},b.prototype.render=function(){return $(this.el).html(this.template(this.model.toJSON())),this},b.prototype.hidePhoto=function(){return console.log("OPTS, ERROR"),$(this).hide()},b.prototype.unrender=function(){return $(this.el).remove()},b}(Backbone.View),a=function(a){function c(){return this.onAlways=i(this.onAlways,this),this.onProgress=i(this.onProgress,this),this.cycleCamera=i(this.cycleCamera,this),this.setAutoCycle=i(this.setAutoCycle,this),c.__super__.constructor.apply(this,arguments)}return g(c,a),c.prototype.el="#cameralist",c.prototype.cameras=[],c.prototype.events={"click #bt-cyclecameras":"cycleCameras"},c.prototype.cycleHistory=[],c.prototype.initialize=function(a){var b,c;return this.settings=a,b=CAMFEEDS.pickSemiRandom(),c=CAMFEEDS.pickSemiRandom(),this.appendCamera(b),this.appendCamera(c),this.render()},c.prototype.setAutoCycle=function(){return setTimeout(function(a){return function(){return setInterval(function(){return a.cycleCamera(0)},e.cycle.left_time)}}(this),e.cycle.left_start),setTimeout(function(a){return function(){return setInterval(function(){return a.cycleCamera(1)},e.cycle.right_time)}}(this),e.cycle.right_start)},c.prototype.appendCamera=function(a){var c;return c=new b({model:a}),this.cameras.push(c),$(this.el).append(c.render().el)},c.prototype.cycleCamera=function(a){var b,c;return null==a&&(a=0),b.on("progress",onProgress),b.on("always",onAlways),c=CAMFEEDS.pickSemiRandom(),this.cameras[a].cycle(c),b=imagesLoaded(this.el)},c.prototype.onProgress=function(){return console.log("Progress loading...")},c.prototype.onAlways=function(){return console.log("Finished loading images")},c.prototype.render=function(){return $(this.el).html()},c}(Backbone.View),window.CAMFEEDS=[],window.app=null,jQuery(function(){return $.getJSON(e.camfeed.url,function(b){return window.CAMFEEDS=new c,_.each(b,function(a){return function(a){var b;return b=new d(a),window.CAMFEEDS.add(b)}}(this)),window.app=new a(e),$("#bt-fullscreen").on("click",f),window.app.setAutoCycle()})})}).call(this);