(function(){var a,b,c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty,h=function(a,b){return function(){return a.apply(b,arguments)}};e=null!=e?e:{el:"#cameralist",cycle:{time_seconds:60,time_random:!0},camfeed:{url:"/assets/cameras.feed.json",feeds:[]}},d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.defaults={uri:"http://158.39.49.51:80/mjpg/video.mjpg",country:"Russia",city:"Megalopole"},b}(Backbone.Model),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.model=d,b.prototype.localStorage=new Store("CameraFeeds"),b}(Backbone.Collection),b=function(a){function b(){return this.unrender=h(this.unrender,this),this.render=h(this.render,this),this.cycle=h(this.cycle,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.tagName="section",b.prototype.className="feed-box",b.prototype.template=_.template('<div class="feed-stream">\n<img src="<%= uri %>" \n    caption="<%= city %>" >\n</div>'),b.prototype.initialize=function(){return this.model.bind("add",this.render),this.model.bind("change",this.render),this.model.bind("remove",this.unrender)},b.prototype.cycle=function(a){return this.model.set("uri",a.get("uri")),this.model.set("city",a.get("uri")),this.model.set("country",a.get("country"))},b.prototype.render=function(){return $(this.el).html(this.template(this.model.toJSON())),this},b.prototype.unrender=function(){return $(this.el).remove()},b}(Backbone.View),a=function(a){function c(){return this.cycleCameras=h(this.cycleCameras,this),c.__super__.constructor.apply(this,arguments)}return f(c,a),c.prototype.el="#cameralist",c.prototype.cameras=[],c.prototype.events={"click #bt-cyclecameras":"cycleCameras"},c.prototype.initialize=function(a){return this.settings=a,this.idx=Math.floor(Math.random()*CAMFEEDS.length-1),this.appendCamera(CAMFEEDS.at(this.idx)),this.appendCamera(CAMFEEDS.at(this.idx+1)),this.render()},c.prototype.appendCamera=function(a){var c;return c=new b({model:a}),this.cameras.push(c),$(this.el).append(c.render().el)},c.prototype.cycleCameras=function(){return console.log("Cycling cameras"),this.idx=Math.floor(Math.random()*CAMFEEDS.length-1),this.cameras[0].cycle(CAMFEEDS.at(this.idx)),this.cameras[1].cycle(CAMFEEDS.at(this.idx+1))},c.prototype.render=function(){return $(this.el).html()},c}(Backbone.View),window.CAMFEEDS=[],window.app=null,jQuery(function(){return $.getJSON(e.camfeed.url,function(b){return window.CAMFEEDS=new c,_.each(b,function(a){return function(a){var b;return console.log(a),b=new d(a),window.CAMFEEDS.add(b)}}(this)),window.app=new a(e),$("#bt-cyclecameras").on("click",window.app.cycleCameras)})})}).call(this);